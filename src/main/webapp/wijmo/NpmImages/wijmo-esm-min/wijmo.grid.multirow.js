/*!
    *
    * Wijmo Library 5.20211.794
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var __extends=this&&this.__extends||function(){var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();import{ObservableArray,NotifyCollectionChangedEventArgs,assert,asBoolean,copy,isArray,toHeaderCase,getType,isIE,asInt,Key,addClass,createElement,hasItems,asArray,toggleClass,isFunction,isString,isBoolean,Event,CancelEventArgs,CollectionViewGroup,NotifyCollectionChangedAction,_registerModule}from"wijmo/wijmo";import{Row,GroupRow,CellRange,RowColFlags,CellRangeEventArgs,Column,ColumnCollection,CellType,FlexGrid,_AddNewHandler,_NewRowTemplate,SelectionMode,AllowDragging,MergeManager}from"wijmo/wijmo.grid";import*as selfModule from"wijmo/wijmo.grid.multirow";var _MultiRow=function(e){__extends(_MultiRow,e);function _MultiRow(t,o,r){var l=e.call(this,t)||this;l._idxData=o;l._idxRecord=r;return l}Object.defineProperty(_MultiRow.prototype,"recordIndex",{get:function(){return this._idxRecord},enumerable:!0,configurable:!0});return _MultiRow}(Row);export{_MultiRow};var _MultiGroupRow=function(e){__extends(_MultiGroupRow,e);function _MultiGroupRow(t,o){var r=e.call(this,t)||this;r._idxRecord=o;return r}Object.defineProperty(_MultiGroupRow.prototype,"recordIndex",{get:function(){return this._idxRecord},enumerable:!0,configurable:!0});Object.defineProperty(_MultiGroupRow.prototype,"hasChildren",{get:function(){return!0},enumerable:!0,configurable:!0});_MultiGroupRow.prototype.getCellRange=function(){var t=this._getLastRowInHeader();return t!=this?t.getCellRange():e.prototype.getCellRange.call(this)};Object.defineProperty(_MultiGroupRow.prototype,"isCollapsed",{get:function(){return this._getLastRowInHeader()._getFlag(RowColFlags.Collapsed)},set:function(e){var t=this._getLastRowInHeader();e!=t.isCollapsed&&null!=t._list&&t._setCollapsed(asBoolean(e))},enumerable:!0,configurable:!0});_MultiGroupRow.prototype._setCollapsed=function(e){var t=this,o=this.grid,r=o.rows,l=this.getCellRange(),n=new CellRangeEventArgs(o.cells,new CellRange(this.index,-1));if(o.onGroupCollapsedChanging(n)){o.deferUpdate((function(){r.deferUpdate((function(){t._setFlag(RowColFlags.Collapsed,e,!0);for(var o=l.topRow+1;o<=l.bottomRow&&o>-1&&o<r.length;o++){r[o]._setFlag(RowColFlags.ParentCollapsed,e,!0);var n=r[o];if(n instanceof _MultiGroupRow){var i=n._getLastRowInHeader();for(o+=1;o<=i.index;o++)(n=r[o])._setFlag(RowColFlags.ParentCollapsed,e,!0);o--}n instanceof GroupRow&&n.isCollapsed&&(o=n.getCellRange().bottomRow)}}))}));o.onGroupCollapsedChanged(n)}};_MultiGroupRow.prototype._getLastRowInHeader=function(){var e=this.grid,t=this;if(e&&e.multiRowGroupHeaders)for(var o=e.rows,r=this.dataItem,l=this.index+1;l<o.length&&o[l].dataItem==r;l++)t=o[l];assert(t instanceof _MultiGroupRow,"last row in header should be a _MultiRowGroup");return t};return _MultiGroupRow}(GroupRow);export{_MultiGroupRow};var MultiRowCellCollection=function(e){__extends(MultiRowCellCollection,e);function MultiRowCellCollection(){return null!==e&&e.apply(this,arguments)||this}MultiRowCellCollection.prototype._setLayout=function(e){this._layout=e;this.forEach((function(t){return t._setLayout(e)}))};MultiRowCellCollection.prototype.onCollectionChanged=function(t){void 0===t&&(t=NotifyCollectionChangedEventArgs.reset);var o=this._layout;o&&o._onLayoutChanged();e.prototype.onCollectionChanged.call(this,t)};return MultiRowCellCollection}(ObservableArray);export{MultiRowCellCollection};var _MultiRowLayout=function(){function _MultiRowLayout(e,t,o){this._initialized=!1;this._disposed=!1;this._rowsPerItem=1;this._groupsByColumn={};this._grid=e;this._changeCallback=o;this._bindingGroups=this._parseCellGroups(t);this._initialized=!0}_MultiRowLayout.prototype._dispose=function(){if(!this._disposed){this._disposed=!0;var e=this._bindingGroups;e.forEach((function(e){e.cells._setLayout(null)}));e._setLayout(null);this._bindingGroups=null}};_MultiRowLayout.prototype._onLayoutChanged=function(){this._initialized&&!this._disposed&&this._changeCallback&&this._changeCallback()};_MultiRowLayout.prototype._parseCellGroups=function(e){var t=this,o=this._grid,r=null,l=1;if(e){if(e instanceof MultiRowCellCollection){e.forEach((function(e){assert(e instanceof MultiRowCellGroup,"groups contain items of invalid type")}));r=e}else{r=new MultiRowCellCollection;for(var n=0;n<e.length;n++){var i=null;i=e[n]instanceof MultiRowCellGroup?e[n]:new MultiRowCellGroup(e[n]);r.push(i)}}r.forEach((function(e){e.openGroup()}));n=0;for(var a=0;n<r.length;n++){(i=r[n])._colstart=a;a+=i._colspanEff;l=Math.max(l,i._rowspanEff)}r.forEach((function(e){e.closeGroup(o,l)}));this._rowsPerItem=l}else r=new MultiRowCellCollection;this._multiRowGroupHeaderRange=this._getMultiRowGroupHeaderRange(r);r.forEach((function(e){e.cells._setLayout(t)}));r._setLayout(this);return r};_MultiRowLayout.prototype._getMultiRowGroupHeaderRange=function(e){for(var t=this._rowsPerItem,o=new CellRange(0,0,t-1,0),r=0;r<e.length;r++){var l=e[r];if(l._hasAggregates){0===r&&this._expandMultiRowGroupHeaderToAggregate(o,l);return o}o.col2=l._colstart+l._colspanEff-1}return o};_MultiRowLayout.prototype._expandMultiRowGroupHeaderToAggregate=function(e,t){var o=this._rowsPerItem,r=t._colspanEff,l=t.cells.filter((function(e){return e.col>0&&0!=e.aggregate})).map((function(e){return e.col})).reduce((function(e,t){return t<e?t:e}),r);e.col2=Math.max(t._colstart+l-1,e.col2);for(var n=l;n<r;n++){for(var i=!0,a=0;a<o;a++){var s=t._getCellRange(a,n);i=i&&s.col===n}if(i){e.col2=Math.max(t._colstart+n-1,e.col2);return}}};_MultiRowLayout.prototype._getSingleRowGroupHeaderRange=function(e,t,o){var r=this._bindingGroups;if(0===r.length)return null;var l=this._getGroupByColumn(o);assert(null!=l,"Failed to get the group!");var n=l._getCellRange(0,o-l._colstart),i=new CellRange(t,l._colstart+n.col,t,l._colstart+n.col2);if(0!=l.getBindingColumn(e,t,o).aggregate)return i;for(var a=r[0]._colstart,s=o-1;s>=a;s--){var u=this._getGroupByColumn(s);assert(null!=u,"Failed to get the group!");if(0!=u.getBindingColumn(e,t,s).aggregate)break;n=u._getCellRange(0,s-u._colstart);i.col=u._colstart+n.col}var c=r[r.length-1],p=c._colstart+c._colspanEff;for(s=o+1;s<p;s++){var d=this._getGroupByColumn(s);assert(null!=d,"Failed to get the group!");if(0!=d.getBindingColumn(e,t,s).aggregate)break;n=d._getCellRange(0,s-d._colstart);i.col2=d._colstart+n.col2}return i};_MultiRowLayout.prototype._getGroupHeaderMergedRange=function(e,t,o,r){if(r){var l=this._multiRowGroupHeaderRange;if(l.containsColumn(o)){var n=this._rowsPerItem,i=Math.floor(t/n)*n;return new CellRange(i+l.row,l.col,i+l.row2,l.col2)}var a=this._getGroupByColumn(o);assert(a instanceof MultiRowCellGroup,"Failed to get the group!");return a.getMergedRange(e,t,o)}return this._getSingleRowGroupHeaderRange(e,t,o)};_MultiRowLayout.prototype._getGroupByColumn=function(e){var t=this._groupsByColumn[e];if(!t)for(var o=this._bindingGroups,r=0;r<o.length;r++)if(e>=(t=o[r])._colstart&&e<=t._colstart+t._colspanEff-1){this._groupsByColumn[e]=t;break}return t};_MultiRowLayout.prototype._updateCellTypes=function(e){this._bindingGroups.forEach((function(t){t._cols.forEach((function(t){null==t.dataType&&t._binding&&(t.dataType=getType(t._binding.getValue(e)));if(!t.isReadOnly){var o=isIE()?null:Object.getOwnPropertyDescriptor(e,t.binding);t.isReadOnly=o&&!o.writable&&!o.set}}))}))};return _MultiRowLayout}();export{_MultiRowLayout};var MultiRowCell=function(e){__extends(MultiRowCell,e);function MultiRowCell(t){var o=e.call(this)||this;o._row=o._col=0;o._rowspan=o._colspan=1;copy(o,t);return o}Object.defineProperty(MultiRowCell.prototype,"row",{get:function(){return this._row},set:function(e){var t=asInt(e,!1,!0);if(this._row!=t){this._row=t;this._onLayoutPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(MultiRowCell.prototype,"col",{get:function(){return this._col},set:function(e){var t=asInt(e,!1,!0);if(this._col!=t){this._col=t;this._onLayoutPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(MultiRowCell.prototype,"colspan",{get:function(){return this._colspan},set:function(e){var t=asInt(e,!1,!0);assert(t>0,"colspan must be >= 1");if(this._colspan!=t){this._colspan=t;this._onLayoutPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(MultiRowCell.prototype,"rowspan",{get:function(){return this._rowspan},set:function(e){var t=asInt(e,!1,!0);assert(t>0,"rowspan must be >= 1");if(this._rowspan!=t){this._rowspan=t;this._onLayoutPropertyChanged()}},enumerable:!0,configurable:!0});MultiRowCell.prototype._setLayout=function(e){this._layout=e};MultiRowCell.prototype._onLayoutPropertyChanged=function(){var e=this._layout;e&&e._onLayoutChanged()};return MultiRowCell}(Column);export{MultiRowCell};var MultiRowCellGroup=function(e){__extends(MultiRowCellGroup,e);function MultiRowCellGroup(t){var o=e.call(this)||this;o._isRowHeader=!1;o._colstart=0;o._cells=new MultiRowCellCollection;copy(o,t);return o}MultiRowCellGroup.prototype._copy=function(e,t){if("cells"==e){isArray(t)&&(this._cellsDef=t);return!0}return!1};Object.defineProperty(MultiRowCellGroup.prototype,"cells",{get:function(){return this._cells},enumerable:!0,configurable:!0});Object.defineProperty(MultiRowCellGroup.prototype,"isRowHeader",{get:function(){return this._isRowHeader},set:function(e){var t=asBoolean(e);if(this._isRowHeader!=t){this._isRowHeader=t;this._onLayoutPropertyChanged()}},enumerable:!0,configurable:!0});MultiRowCellGroup.prototype.openGroup=function(){if(!this._isParsed){this._cells=this._parseCells(this._cellsDef);this._isParsed=!0}this._calculate()};MultiRowCellGroup.prototype.closeGroup=function(e,t){var o=this;if(t>this._rowspanEff){this._cells.forEach((function(e){e.row==o._rowspanEff-1&&(e._rowspanEff=t-e.row)}));this._rowspanEff=t}this._cells.forEach((function(e){for(;e.col+e._colspanEff<o._colspanEff&&!o._slotTaken(e.row,e.col+e._colspanEff);)e._colspanEff++}));this._cells.forEach((function(e){for(;e.row+e._rowspanEff<o._rowspanEff&&!o._slotTaken(e.row+e._rowspanEff,e.col);)e._rowspanEff++}));if(this._cells.length>0)for(var r=0;r<this._rowspanEff;r++)for(var l=0;l<this._colspanEff;l++)assert(this._slotTaken(r,l),"Invalid layout (empty cells).");this._cols=new ColumnCollection(e,e.columns.defaultSize);this._rng=new Array(t*this._colspanEff);this._cells.forEach((function(e){for(var t=0;t<e._rowspanEff;t++)for(var r=0;r<e._colspanEff;r++){var l=(e.row+t)*o._colspanEff+e.col+r;o._cols.setAt(l,e);var n=new CellRange(0-t,0-r,0-t+e._rowspanEff-1,0-r+e._colspanEff-1);n.isSingleCell||(o._rng[l]=n)}}));var n=this._colstart;this._rng[-1]=new CellRange(0,n,0,n+this._colspanEff-1);this._hasAggregates=!1;for(var i=0;i<this._cells.length&&!this._hasAggregates;i++)this._hasAggregates=0!=this._cells[i].aggregate};MultiRowCellGroup.prototype.getColumnWidth=function(e){for(var t=0;t<this._cells.length;t++){var o=this._cells[t];if(o.col==e&&1==o._colspanEff)return o.width}return null};MultiRowCellGroup.prototype.getMergedRange=function(e,t,o){if(t<0)return this._rng[-1];var r=e.rows[t],l=null!=r.recordIndex?r.recordIndex:t%this._rowspanEff,n=o-this._colstart,i=this._rng[l*this._colspanEff+n];e.cellType==CellType.ColumnHeader&&t++;return i?new CellRange(t+i.row,o+i.col,t+i.row2,o+i.col2):null};MultiRowCellGroup.prototype.getBindingColumn=function(e,t,o){if(t<0)return this;var r=e.rows[t],l=r&&null!=r.recordIndex?r.recordIndex:t%this._rowspanEff,n=o-this._colstart;return this._cols[l*this._colspanEff+n]};MultiRowCellGroup.prototype.getColumn=function(e){return this._cols.getColumn(e)};MultiRowCellGroup.prototype._getCellRange=function(e,t){var o=this._rng[e*this._colspanEff+t];return o?new CellRange(e+o.row,t+o.col,e+o.row2,t+o.col2):new CellRange(e,t)};MultiRowCellGroup.prototype._parseCells=function(e){var t=this._cells;if(e){if(e instanceof MultiRowCellCollection){e.forEach((function(e){assert(e instanceof MultiRowCell,"cells contain items of invalid type")}));t=e}else e.forEach((function(e){var o=null;o=e instanceof MultiRowCell?e:new MultiRowCell(e);t.push(o)}));t.forEach((function(e){e.binding&&!e.header&&(e.header=toHeaderCase(e.binding))}))}return t};MultiRowCellGroup.prototype._clearCalculations=function(){this._colstart=0;this._cols=null;this._hasAggregates=!1;this._rng=null;this.row=0;this.col=0;this._colspanEff=0;this._rowspanEff=0;this._cells.forEach((function(e){e.row=0;e.col=0;e._colspanEff=0;e._rowspanEff=0}))};MultiRowCellGroup.prototype._calculate=function(){var e=this;this._clearCalculations();this._colspanEff=this.colspan;this._rowspanEff=this.rowspan;this._cells.forEach((function(t){e._colspanEff=Math.max(e._colspanEff,t.colspan);t._colspanEff=t.colspan;t._rowspanEff=t.rowspan}));var t=0,o=0;this._cells.forEach((function(r,l){for(;!e._cellFits(r,l,t,o);)0==(o=(o+1)%e._colspanEff)&&t++;r.row=t;r.col=o}));var r=1,l=1;this._cells.forEach((function(e){r=Math.max(r,e.row+e._rowspanEff);l=Math.max(l,e.col+e._colspanEff)}));this._rowspanEff=r;this._colspanEff=l};MultiRowCellGroup.prototype._cellFits=function(e,t,o,r){if(r>0&&r+e._colspanEff>this._colspanEff)return!1;for(var l=0;l<e._colspanEff;l++)if(this._slotTaken(o,r+l,t))return!1;this._colspanEff=Math.max(this._colspanEff,r+e._colspanEff-1);return!0};MultiRowCellGroup.prototype._slotTaken=function(e,t,o){void 0===o&&(o=this._cells.length);for(var r=0;r<o;r++){var l=this._cells[r];if(e>=l.row&&e<=l.row+l._rowspanEff-1&&t>=l.col&&t<=l.col+l._colspanEff-1)return!0}return!1};return MultiRowCellGroup}(MultiRowCell);export{MultiRowCellGroup};var MultiRow=function(e){__extends(MultiRow,e);function MultiRow(t,o){var r=e.call(this,t)||this;r._hdrLayoutDef=null;r._centerVert=!0;r._collapsedHeaders=!1;r._multiRowGroupHeaders=!1;r._rowHdrCnt=0;r.collapsedHeadersChanging=new Event;r.collapsedHeadersChanged=new Event;r._layoutDef=new MultiRowCellCollection;r._layout=new _MultiRowLayout(r,r._layoutDef,(function(){return r._onLayoutChanged()}));addClass(r.hostElement,"wj-multirow");var l=r.columnHeaders.hostElement.parentElement,n=createElement('<div class="wj-hdr-collapse"><span></span></div>');n.style.display="none";l.appendChild(n);r._btnCollapse=n;r._updateButtonGlyph();r.addEventListener(n,"mousedown",(function(e){switch(r.collapsedHeaders){case null:case!1:r._collapsedHeadersWasNull=null==r.collapsedHeaders;r.collapsedHeaders=!0;break;case!0:r.collapsedHeaders=!!r._collapsedHeadersWasNull&&null}e.preventDefault();r.focus()}),!0);var i=r.hostElement;r.addEventListener(i,"mousedown",(function(e){if(!r._mouseHdl._szRowCol){var t=r._layout?r._layout._bindingGroups:null,o=t&&t.length?t[0]:null;if(o&&o.isRowHeader){var l=r.hitTest(e);if(l.panel==r.columnHeaders&&l.col<r.frozenColumns){e.preventDefault();r.selectAll()}}}}),!0);["dragover","dragleave","dragdrop"].forEach((function(e){r.removeEventListener(i,e)}));r._addHdl=new _MultiRowAddNewHandler(r);r.formatItem.addHandler(r._formatItem,r);r.autoGenerateColumns=!1;r.allowDragging=AllowDragging.None;r.mergeManager=new _MergeManager;r.initialize(o);return r}MultiRow.prototype._getProductInfo=function(){return"H87K,MultiRow"};Object.defineProperty(MultiRow.prototype,"layoutDefinition",{get:function(){return this._layoutDef},set:function(e){var t=this;this.finishEditing()||this.finishEditing(!0);this._layoutDef=asArray(e);if(this._layout){this._layout._dispose();this._layout=null}this._layout=new _MultiRowLayout(this,e,(function(){return t._onLayoutChanged()}));this._rowHdrCnt=0;if(this._layout)for(var o=this._layout._bindingGroups,r=0;r<o.length;r++){var l=o[r];if(!l.isRowHeader)break;this._rowHdrCnt=l._colstart+l._colspanEff;l.cells.forEach((function(e){e.isReadOnly=!0;!e.header||e.binding||e.cellTemplate||(e.cellTemplate=e.header);e.cssClass?e.cssClass.indexOf("wj-header")<0&&(e.cssClass+=" wj-header"):e.cssClass="wj-header"}))}this._rowHdrCnt&&(this.frozenColumns=this._rowHdrCnt);this._bindGrid(!0);this._rowHdrCnt&&this.selectionMode&&this.select(this.selection.row,this._rowHdrCnt)},enumerable:!0,configurable:!0});Object.defineProperty(MultiRow.prototype,"headerLayoutDefinition",{get:function(){return this._hdrLayoutDef},set:function(e){var t=this;this._hdrLayoutDef=asArray(e);if(this._hdrLayout){this._hdrLayout._dispose();this._hdrLayout=null}var o=null;e&&(o=new _MultiRowLayout(this,e,(function(){return t._onHeaderLayoutChanged()})));this._hdrLayout=o;this._bindGrid(!0)},enumerable:!0,configurable:!0});Object.defineProperty(MultiRow.prototype,"rowsPerItem",{get:function(){return this._layout._rowsPerItem},enumerable:!0,configurable:!0});MultiRow.prototype.getBindingColumn=function(e,t,o){return this._getBindingColumn(e,t,e.columns[o])};MultiRow.prototype.getColumn=function(t){if(isString(t)){for(var o=this._layout._bindingGroups,r=null,l=0;l<o.length&&!r;l++)r=o[l].getColumn(t);return r}return e.prototype.getColumn.call(this,t)};Object.defineProperty(MultiRow.prototype,"centerHeadersVertically",{get:function(){return this._centerVert},set:function(e){if(e!=this._centerVert){this._centerVert=asBoolean(e);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(MultiRow.prototype,"collapsedHeaders",{get:function(){return this._collapsedHeaders},set:function(e){if(e!=this._collapsedHeaders){var t=new CancelEventArgs;if(this.onCollapsedHeadersChanging(t)){this._collapsedHeaders=asBoolean(e,!0);this._updateCollapsedHeaders();this._updateButtonGlyph();this.onCollapsedHeadersChanged(t)}}},enumerable:!0,configurable:!0});Object.defineProperty(MultiRow.prototype,"showHeaderCollapseButton",{get:function(){return""==this._btnCollapse.style.display},set:function(e){e!=this.showHeaderCollapseButton&&(this._btnCollapse.style.display=asBoolean(e)?"":"none")},enumerable:!0,configurable:!0});Object.defineProperty(MultiRow.prototype,"multiRowGroupHeaders",{get:function(){return this._multiRowGroupHeaders},set:function(e){if(e!=this._multiRowGroupHeaders){this._multiRowGroupHeaders=asBoolean(e);this._bindGrid(!0)}},enumerable:!0,configurable:!0});MultiRow.prototype.onCollapsedHeadersChanging=function(e){this.collapsedHeadersChanging.raise(this,e);return!e.cancel};MultiRow.prototype.onCollapsedHeadersChanged=function(e){this.collapsedHeadersChanged.raise(this,e)};Object.defineProperty(MultiRow.prototype,"allowPinning",{get:function(){return!1},set:function(e){assert(!e,"MultiRow does not support pinning.")},enumerable:!0,configurable:!0});MultiRow.prototype.onSelectionChanging=function(t){var o=t._rng;if(o&&o.isValid&&this.selectionMode){var r=this._mouseHdl._htDown,l=this.rows,n=this.columns,i=this._rowHdrCnt;if(i){o.col=Math.max(o.col,i);o.col2=Math.max(o.col2,i)}if(r&&(r.panel==this.rowHeaders||r.panel==this.cells&&r.col<i)){var a=l[o.topRow],s=l[o.bottomRow];if(a&&null!=a.recordIndex){var u=a.index-a.recordIndex,c=s instanceof _MultiGroupRow&&!this._multiRowGroupHeaders?1:this.rowsPerItem,p=s.index-s.recordIndex+c-1,d=n.length-1,f=o.row!=o.topRow?new CellRange(p,0,u,d):new CellRange(u,0,p,d);o.row=f.row;o.row2=f.row2;o.col2=d;switch(this.selectionMode){case SelectionMode.Cell:o.row2=f.row;o.col2=f.col;break;case SelectionMode.Row:o.row2=f.row}}}}return e.prototype.onSelectionChanging.call(this,t)};MultiRow.prototype._getDeleteColumnIndex=function(){return this._rowHdrCnt};MultiRow.prototype._getQuickAutoSize=function(){return isBoolean(this.quickAutoSize)?this.quickAutoSize:this.formatItem.handlerCount<=1&&null==this.itemFormatter};MultiRow.prototype._addBoundRow=function(e,t){for(var o=e[t],r=0;r<this.rowsPerItem;r++)this.rows.push(new _MultiRow(o,t,r))};MultiRow.prototype._addNode=function(e,t,o){this._addBoundRow(e,t)};MultiRow.prototype._addGroupRow=function(e){for(var t=this._multiRowGroupHeaders?this.rowsPerItem:1,o=0;o<t;o++)this.rows.push(new _MultiGroupRow(e,o))};MultiRow.prototype._bindColumns=function(){for(var e=this,t=this.columnHeaders.rows,o=this._layout,r=this._hdrLayout,l=(r?r._rowsPerItem:this.rowsPerItem)+1;t.length>l;)t.removeAt(t.length-1);for(;t.length<l;)t.push(new Row);this._updateCollapsedHeaders();this.columns.clear();if(o){var n="width,minWidth,maxWidth,binding,header,format,dataMap,name,aggregate,cellTemplate".split(",");o._bindingGroups.forEach((function(t){for(var _loop_1=function(o){if(0===t.cells.length)return"continue";for(var r=new Column,_loop_2=function(e){var l=t.cells[e];l.col==o&&n.forEach((function(e){null!=l[e]&&l[e]!=r[e]&&(r[e]=l[e])}))},l=0;l<t.cells.length;l++)_loop_2(l);e.columns.push(r)},o=0;o<t._colspanEff;o++)_loop_1(o)}))}};MultiRow.prototype._updateCollapsedHeaders=function(){var e=this.columnHeaders.rows,t=this.collapsedHeaders;e[0].visible=0!=t;for(var o=1;o<e.length;o++)e[o].visible=1!=t};MultiRow.prototype._updateColumnTypes=function(){e.prototype._updateColumnTypes.call(this);var t=this.collectionView;if(hasItems(t)){var o=t.items[0];this._layout&&this._layout._updateCellTypes(o);this._hdrLayout&&this._hdrLayout._updateCellTypes(o)}};MultiRow.prototype._getBindingColumn=function(e,t,o){if(e==this.cells||e==this.columnHeaders){var r=e.cellType==CellType.ColumnHeader;r&&t--;o=this._getGroupByColumn(o.index,r).getBindingColumn(e,t,o.index)}return o};MultiRow.prototype._getBindingColumns=function(){var e=[];this._layout._bindingGroups.forEach((function(t){t._cols.forEach((function(t){e.indexOf(t)<0&&e.push(t)}))}));return e};MultiRow.prototype._getRowsPerItem=function(){return this.rowsPerItem};MultiRow.prototype._cvCollectionChanged=function(e,t){if(this.autoGenerateColumns&&0==this.columns.length)this._bindGrid(!0);else{var o=NotifyCollectionChangedAction;switch(t.action){case o.Change:this.invalidate();break;case o.Add:if(t.index==this.collectionView.items.length-1){for(var r=this.rows.length;r>0&&this.rows[r-1]instanceof _NewRowTemplate;)r--;for(var l=0;l<this.rowsPerItem;l++)this.rows.insert(r+l,new _MultiRow(t.item,t.index,l));return}assert(!1,"added item should be the last one.");break;default:this._bindGrid(!1)}}};MultiRow.prototype._getGroupByColumn=function(e,t){var o=null;t&&this._hdrLayout&&!this.collapsedHeaders&&(o=this._hdrLayout._getGroupByColumn(e));o||(o=this._layout._getGroupByColumn(e));assert(o instanceof MultiRowCellGroup,"Failed to get the group!");return o};MultiRow.prototype._onLayoutChanged=function(){this.layoutDefinition=this._layoutDef};MultiRow.prototype._onHeaderLayoutChanged=function(){this.headerLayoutDefinition=this._hdrLayoutDef};MultiRow.prototype._formatItem=function(e,t){var o=this.rowsPerItem,r=t.panel,l=r.cellType,n=r.rows[t.range.row],i=r.rows[t.range.row2],a=t.cell,s=CellType;l==s.ColumnHeader&&toggleClass(a,"wj-group-header",0==t.range.row);if(l==s.Cell||l==s.ColumnHeader){var u=this._getGroupByColumn(t.col,l==s.ColumnHeader);toggleClass(a,"wj-group-start",u._colstart==t.range.col);toggleClass(a,"wj-group-end",u._colstart+u._colspanEff-1==t.range.col2)}if(o>1&&(l==s.Cell||l==s.RowHeader)){var c=i instanceof _MultiRow||i instanceof _MultiRowNewRowTemplate;toggleClass(a,"wj-record-start",!!(n instanceof _MultiRow||n instanceof _MultiRowNewRowTemplate)&&0==n.recordIndex);toggleClass(a,"wj-record-end",!!c&&i.recordIndex==o-1)}var p=this.alternatingRowStep;if(p){var d=!1;if(n instanceof _MultiRow){d=n.dataIndex%(p+1)==0;1==p&&(d=!d)}toggleClass(a,"wj-alt",d)}if(this._centerVert&&!a.getAttribute("wj-state-measuring")){var f=t.range.rowSpan>1;if(f&&t.updateContent)if(0==a.childElementCount)a.innerHTML="<div>"+a.innerHTML+"</div>";else{var _=document.createElement("div"),h=document.createRange();h.selectNodeContents(a);h.surroundContents(_)}toggleClass(a,"wj-center-vert",f)}};MultiRow.prototype._updateButtonGlyph=function(){var e=this._btnCollapse.querySelector("span");e instanceof HTMLElement&&(e.className=this.collapsedHeaders?"wj-glyph-left":"wj-glyph-down-left")};MultiRow.prototype._getError=function(t,o,r,l){if(isFunction(this.itemValidator)&&t==this.rowHeaders)for(var n=0;n<this.rowsPerItem;n++)for(r=0;r<this.columns.length;r++){var i=this.itemValidator(o+n,r,l);if(i)return i}return e.prototype._getError.call(this,t,o,r,l)};return MultiRow}(FlexGrid);export{MultiRow};var _MergeManager=function(e){__extends(_MergeManager,e);function _MergeManager(){return null!==e&&e.apply(this,arguments)||this}_MergeManager.prototype.getMergedRange=function(e,t,o,r){void 0===r&&(r=!0);var l=e.grid;if(t<0||t>=e.rows.length||o<0||o>=e.columns.length)return null;switch(e.cellType){case CellType.Cell:case CellType.RowHeader:if(e.rows[t]instanceof GroupRow&&!l.multiRowGroupHeaders)return this._getGroupRowMergedRange(e,t,o,r,!1)}switch(e.cellType){case CellType.Cell:if(e.rows[t]instanceof GroupRow)return this._getGroupRowMergedRange(e,t,o,r,l.multiRowGroupHeaders);case CellType.ColumnHeader:var n=e.cellType==CellType.ColumnHeader,i=l._getGroupByColumn(o,n);assert(i instanceof MultiRowCellGroup,"Failed to get the group!");var a=n?i.getMergedRange(e,t-1,o):i.getMergedRange(e,t,o),s=e.columns.frozen;if(s&&a&&a.columnSpan>1&&a.col<s&&a.col2>=s){a=a.clone();o<s?a.col2=s-1:a.col=s}var u=e.rows.frozen;if(u&&a&&a.rowSpan>1&&e.cellType==CellType.Cell&&a.row<u&&a.row2>=u){a=a.clone();t<u?a.row2=u-1:a.row=u}assert(!a||a.contains(t,o),"Merged range must contain source cell");return a;case CellType.RowHeader:var c=l.rowsPerItem,p=t-e.rows[t].recordIndex,d=Math.min(p+c-1,e.rows.length-1);return new CellRange(p,0,d,e.columns.length-1);case CellType.TopLeft:var f=l.collapsedHeaders,_=0!=f?0:1,h=1!=f?e.rows.length-1:1;return new CellRange(_,0,h,e.columns.length-1)}return null};_MergeManager.prototype._getGroupRowMergedRange=function(t,o,r,l,n){void 0===l&&(l=!0);var i=t.grid,a=t.cellType,s=t.rows[o];if(i.showGroups&&!i.childItemsPath&&s instanceof _MultiGroupRow&&s.dataItem instanceof CollectionViewGroup&&a==CellType.Cell){return i._layout._getGroupHeaderMergedRange(t,o,r,n)}return e.prototype.getMergedRange.call(this,t,o,r,l)};return _MergeManager}(MergeManager);export{_MergeManager};var _MultiRowAddNewHandler=function(e){__extends(_MultiRowAddNewHandler,e);function _MultiRowAddNewHandler(t){t._addHdl._detach();return e.call(this,t)||this}_MultiRowAddNewHandler.prototype.updateNewRowTemplate=function(){for(var e=this._g.editableCollectionView,t=this._g,o=t.rows,r=e&&e.canAddNew&&t.allowAddNew&&!t.isReadOnly,l=-1,n=0;n<o.length;n+=t.rowsPerItem)if(o[n]instanceof _MultiRowNewRowTemplate){l=n;break}if(r&&l>-1&&(this._top&&l>0||!this._top&&0==l)){l=-1;this._removeNewRowTemplate()}if(r&&l<0)for(n=0;n<t.rowsPerItem;n++){var i=new _MultiRowNewRowTemplate(n);this._top?o.insert(n,i):o.push(i)}!r&&l>-1&&this._removeNewRowTemplate()};_MultiRowAddNewHandler.prototype._keydown=function(t){e.prototype._keydown.call(this,t);t.defaultPrevented||t.keyCode!=Key.Escape||this._copyNewDataItem()};_MultiRowAddNewHandler.prototype._rowEditEnded=function(t,o){e.prototype._rowEditEnded.call(this,t,o);this._copyNewDataItem()};_MultiRowAddNewHandler.prototype._beginningEdit=function(t,o){e.prototype._beginningEdit.call(this,t,o);this._top&&!t.rows[0].dataItem&&this._copyNewDataItem()};_MultiRowAddNewHandler.prototype._copyNewDataItem=function(){if(this._top)for(var e=this._g,t=e.rows,o=0;o<e.rowsPerItem;o++)t[o]instanceof _NewRowTemplate&&(t[o].dataItem=this._nrt.dataItem)};_MultiRowAddNewHandler.prototype._removeNewRowTemplate=function(){for(var e=0,t=this._g.rows;e<t.length;e++)if(t[e]instanceof _NewRowTemplate){t.removeAt(e);e--}};return _MultiRowAddNewHandler}(_AddNewHandler);export{_MultiRowAddNewHandler};var _MultiRowNewRowTemplate=function(e){__extends(_MultiRowNewRowTemplate,e);function _MultiRowNewRowTemplate(t){var o=e.call(this)||this;o._idxRecord=t;return o}Object.defineProperty(_MultiRowNewRowTemplate.prototype,"recordIndex",{get:function(){return this._idxRecord},enumerable:!0,configurable:!0});return _MultiRowNewRowTemplate}(_NewRowTemplate);export{_MultiRowNewRowTemplate};_registerModule("wijmo.grid.multirow",selfModule);