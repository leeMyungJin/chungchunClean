/*!
    *
    * Wijmo Library 5.20211.794
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var __extends=this&&this.__extends||function(){var extendStatics=function(e,l){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,l){e.__proto__=l}||function(e,l){for(var t in l)l.hasOwnProperty(t)&&(e[t]=l[t])})(e,l)};return function(e,l){extendStatics(e,l);function __(){this.constructor=e}e.prototype=null===l?Object.create(l):(__.prototype=l.prototype,new __)}}();import{_getModule,Control,Globalize,DataType,asBoolean,isString,isNumber,isInt,isDate,isFunction,isNullOrWhiteSpace,isObject,asEnum,getType,copy,_registerModule}from"wijmo/wijmo";import{FlexGrid,Row,GroupRow,Column,CellRange,CellRangeEventArgs,RowColFlags,CellType,_NewRowTemplate}from"wijmo/wijmo.grid";import*as mXlsx from"wijmo/wijmo.xlsx";import*as selfModule from"wijmo/wijmo.grid.xlsx";export function softDetail(){return _getModule("wijmo.grid.detail")}export function softMultiRow(){return _getModule("wijmo.grid.multirow")}export function softTransposed(){return _getModule("wijmo.grid.transposed")}export function softTransposedMultiRow(){return _getModule("wijmo.grid.transposedmultirow")}var FlexGridXlsxConverter=function(){function FlexGridXlsxConverter(){}FlexGridXlsxConverter.save=function(e,l,t){var o=new mXlsx.Workbook;this._saveFlexGridToWorkbook(o,e,l,!1,null);t&&o.save(t);return o};FlexGridXlsxConverter.saveAsync=function(e,l,t,o,r,n,s){var i=this,a=new mXlsx.Workbook;if(!s){this._saveFlexGridToWorkbook(a,e,l,!1,null);t?a.saveAsync(t,(function(e){isFunction(o)&&o(e,a)}),r,null):isFunction(o)&&o(null,a);return a}var u=null!=t;this.cancelAsync((function(){var s,c=[e.collectionView&&e.collectionView.collectionChanged,e.columns&&e.columns.collectionChanged,e.rows&&e.rows.collectionChanged,e.resizedColumn,e.resizedRow],removeHandlers=function(){return c.forEach((function(e){e&&e.removeHandler(restart)}))},restart=function(){i._cs&&i._cs.cancel(!1);clearTimeout(s);s=setTimeout((function(){removeHandlers();a=null;i.saveAsync(e,l,t,o,r,n)}),100)},finish=function(){clearTimeout(s);i._cs=null;removeHandlers()};i._cs=new mXlsx._SyncPromise(null,finish);c.forEach((function(e){e&&e.addHandler(restart)}));i._saveFlexGridToWorkbook(a,e,l,!0,i._cs,(function(e){isFunction(n)&&n(u?Math.round(mXlsx._map(e,0,100,0,50)):e)})).then((function(){if(t){a._externalCancellation=function(){return i._cs};a.saveAsync(t,(function(e){finish();isFunction(o)&&o(e,a)}),(function(e){finish();isFunction(r)&&r(e)}),(function(e){isFunction(n)&&n(Math.round(mXlsx._map(e,0,100,51,100)))}))}else{finish();isFunction(n)&&n(100);isFunction(o)&&o(null,a)}}),(function(e){finish();throw e}))}));return null};FlexGridXlsxConverter.cancelAsync=function(e){var l=this;if(this._cs){this._cs.cancel();setTimeout((function(){l._cs=null;isFunction(e)&&e()}),100)}else isFunction(e)&&e()};FlexGridXlsxConverter.load=function(e,l,t){var o=this;if(l instanceof Blob)_blobToBuffer(l,(function(r){l=null;var n=new mXlsx.Workbook;n.load(r);r=null;e.deferUpdate((function(){o._loadToFlexGrid(e,n,t);n=null}))}));else if(l instanceof mXlsx.Workbook)e.deferUpdate((function(){o._loadToFlexGrid(e,l,t);l=null}));else{if(!(l instanceof ArrayBuffer||isString(l)))throw"Invalid workbook.";var r=new mXlsx.Workbook;r.load(l);l=null;e.deferUpdate((function(){o._loadToFlexGrid(e,r,t);r=null}))}};FlexGridXlsxConverter.loadAsync=function(e,l,t,o,r){var n=this;if(l instanceof Blob)_blobToBuffer(l,(function(s){l=null;var i=new mXlsx.Workbook;i.loadAsync(s,(function(){s=null;e.deferUpdate((function(){n._loadToFlexGrid(e,i,t);o&&o(i);i=null}))}),r)}));else if(l instanceof mXlsx.Workbook)e.deferUpdate((function(){n._loadToFlexGrid(e,l,t);o&&o(l);l=null}));else{if(!(l instanceof ArrayBuffer||isString(l)))throw"Invalid workbook.";var s=new mXlsx.Workbook;s.loadAsync(l,(function(){l=null;e.deferUpdate((function(){n._loadToFlexGrid(e,s,t);o&&o(s);s=null}))}),r)}};FlexGridXlsxConverter._saveFlexGridToWorkbook=function(e,l,t,o,r,n){var s=new mXlsx._SyncPromise(r),i=new mXlsx.WorkSheet,a=!t||null==t.includeColumnHeaders||t.includeColumnHeaders,u=!(!t||null==t.includeRowHeaders)&&t.includeRowHeaders,c=_IncludeCellStyles.Cache,d=t?t.includeColumns:null,f=t?t.formatItem:null,h=[];t&&(c=!1===asBoolean(t.includeCellStyles,!0)?_IncludeCellStyles.None:!1===asBoolean(t.quickCellStyles,!0)?_IncludeCellStyles.Regular:_IncludeCellStyles.Cache);var m=c===_IncludeCellStyles.Cache?new _StyleCache(500):null;null==this.hasCssText&&(this.hasCssText="cssText"in document.body.style);var p,x=l.wj_sheetInfo;i.name=t?t.sheetName:"";i.visible=!t||!1!==t.sheetVisible;if(x&&x.tables&&x.tables.length>0)for(var g=0;g<x.tables.length;g++)i.tables.push(x.tables[g]);if(!x&&(c!==_IncludeCellStyles.None||f)){(p=document.createElement("div")).style.visibility="hidden";p.setAttribute(FlexGrid._WJS_MEASURE,"true");l.hostElement.appendChild(p)}var w=u?l.rowHeaders.columns.length:0,_=this._getPerRowColumnsSettings(l,u?[l.topLeftCells,l.columnHeaders]:[l.columnHeaders]),C=_.cols,v=softMultiRow()&&l instanceof softMultiRow().MultiRow?this._getPerRowColumnsSettings(l,u?[l.rowHeaders,l.cells]:[l.cells],l.rowsPerItem).cols:null,y=C.length,b=[[l.topLeftCells,l.columnHeaders],[l.rowHeaders,l.cells],[l.bottomLeftCells,l.columnFooters]];a||b.shift();var S=b.map((function(e){return e[1].rows.length})).reduce((function(e,l){return e+l}));C.length&&C[0].forEach((function(e,l){var t=_.bndCols[0][l];if(!(l>=w&&d)||d(t)){var o=new mXlsx.WorkbookColumn;o._deserialize(e);i._addWorkbookColumn(o)}}));this._saveContentToWorksheet(r,o,Date.now(),0,{panels:b,panelIdx:0,globRowIdx:0,rowsOffset:0,totalRows:S},l,i,u,(function(e){return e==CellType.Cell&&v?v:C}),c,p,h,m,d,f,(function(e){n(Math.round(e/S*100))}),(function(){var o=new mXlsx.WorkbookFrozenPane;o.rows=a?l.frozenRows+y:l.frozenRows;o.columns=u?l.frozenColumns+w:l.frozenColumns;i.frozenPane=o;e._addWorkSheet(i);if(!x&&(c!==_IncludeCellStyles.None||f)){l.hostElement.removeChild(p);h.forEach((function(e){return e.forEach((function(e){e&&e.parentElement&&e.parentElement.removeChild(e)}))}))}m&&m.clear();e.activeWorksheet=t?t.activeWorksheet:null;s.resolve()}));return s};FlexGridXlsxConverter._saveContentToWorksheet=function(e,l,t,o,r,n,s,i,a,u,c,d,f,h,m,p,x){for(var g=this,w=u?20:200,_loop_1=function(C){if(e&&e.cancelled)return{value:void 0};if(l&&C-o>w&&Date.now()-t>100){setTimeout((function(){if(!e||!e.cancelled){p(C);g._saveContentToWorksheet(e,l,Date.now(),C,r,n,s,i,a,u,c,d,f,h,m,p,x)}}),0);return{value:void 0}}for(;C-r.rowsOffset>=r.panels[r.panelIdx][1].rows.length;){r.rowsOffset+=r.panels[r.panelIdx][1].rows.length;r.panelIdx++}var v=r.panels[r.panelIdx],y=v[0],b=v[1],S=C-r.rowsOffset,T=b.rows[S];if(b.cellType!==CellType.Cell&&T.renderSize<=0||T instanceof _NewRowTemplate)return"continue";var F=0,X={},k=new mXlsx.WorkbookRow,R=T instanceof GroupRow,G=0;b.cellType===CellType.Cell&&(R?G=T.level:n.rows.maxGroupLevel>-1&&(G=n.rows.maxGroupLevel+1));var W=a(b.cellType);i&&(F=_._parseFlexGridRowToSheetRow(y,X,S,0,W,u,c,d,f,R,G,h,m));_._parseFlexGridRowToSheetRow(b,X,S,F,W,u,c,d,f,R,G,h,m);if(X.cells.length>0){k._deserialize(X);s._addWorkbookRow(k,r.globRowIdx)}r.globRowIdx++},_=this,C=o;C<r.totalRows;C++){var v=_loop_1(C);if("object"==typeof v)return v.value}isFunction(x)&&x()};FlexGridXlsxConverter._loadToFlexGrid=function(e,l,t){if(softTransposedMultiRow()&&e instanceof softTransposedMultiRow().TransposedMultiRow)throw"Not supported.";t=t||{};var o,r=null!=e.wj_sheetInfo,n={},s=[],i=[],a={};e.itemsSource=null;e.columns.clear();e.columnHeaders.rows.clear();e.rows.clear();e.frozenColumns=0;e.frozenRows=0;var u=null==t.sheetIndex||isNaN(t.sheetIndex)?0:t.sheetIndex;if(u<0||u>=l.sheets.length)throw"The sheet index option is out of the sheet range of current workbook.";if(null!=t.sheetName)for(var c=0;c<l.sheets.length;c++)if(t.sheetName===l.sheets[c].name){o=l.sheets[c];break}if(null!=(o=o||l.sheets[u]).rows){for(var d=this._getColumnCount(o.rows),f=this._getRowCount(o.rows,d),h=o.columns,m=0;m<d;m++){e.columns.push(new Column);if(h[m]){isNaN(+h[m].width)||(e.columns[m].width=+h[m].width);h[m].visible||null==h[m].visible||(e.columns[m].visible=!!h[m].visible);h[m].style&&h[m].style.wordWrap&&(e.columns[m].wordWrap=h[m].style.wordWrap)}}var p,x=(null==t.includeColumnHeaders||t.includeColumnHeaders)&&o.rows.length>0,g=x?this._getColumnHeadersHeight(o):0,w=!1,_=[],C=o.frozenPane&&o.frozenPane.rows,v=o.frozenPane&&o.frozenPane.columns;C=isNumber(C)&&!isNaN(C)?C:null;v=isNumber(v)&&!isNaN(v)?v:null;for(var y=g;y<f;y++){var b=!1,S=null,T=o.rows[y];if(T)for(var F=y+1;F<o.rows.length;){var X=o.rows[F];if(X){(isNaN(T.groupLevel)&&!isNaN(X.groupLevel)||!isNaN(T.groupLevel)&&T.groupLevel<X.groupLevel)&&(b=!0);break}F++}if(b&&!o.summaryBelow){p&&(p.isCollapsed=w);(p=new GroupRow).isReadOnly=!1;w=null!=T.collapsed&&T.collapsed;p.level=isNaN(T.groupLevel)?0:T.groupLevel;a[p.level]=w;this._checkParentCollapsed(a,p.level)&&p._setFlag(RowColFlags.ParentCollapsed,!0);e.rows.push(p)}else{var k=new Row;T&&this._checkParentCollapsed(a,T.groupLevel)&&k._setFlag(RowColFlags.ParentCollapsed,!0);e.rows.push(k)}T&&T.height&&!isNaN(T.height)&&(e.rows[y-g].height=T.height);for(m=0;m<d;m++)if(T){var R=T.cells[m],G=R?R.formula:null;G&&"="!==G[0]&&(G="="+G);if(R&&R.textRuns&&R.textRuns.length>0){e.rows[y-g].isContentHtml=!0;e.setCellData(y-g,m,this._parseTextRunsToHTML(R.textRuns))}else e.setCellData(y-g,m,G&&r?G:this._getItemValue(R));b||this._setColumn(_,m,R);var W=y*d+m,I=R?R.style:null;if(I){S=null==S?!!I.wordWrap:S&&!!I.wordWrap;if(r){var A=mXlsx.Workbook._parseExcelFormat(R),N=void 0;if(I.hAlign)N=mXlsx.Workbook._parseHAlignToString(asEnum(I.hAlign,mXlsx.HAlign));else switch(this._getItemType(R)){case DataType.Number:N="right";break;case DataType.Boolean:N="center";break;default:N=A&&0===A.search(/[n,c,p]/i)?"right":"left"}n[W]={fontWeight:I.font&&I.font.bold?"bold":"none",fontStyle:I.font&&I.font.italic?"italic":"none",textDecoration:I.font&&I.font.underline?"underline":"none",textAlign:N,fontFamily:I.font&&I.font.family?I.font.family:"",fontSize:I.font&&I.font.size?I.font.size+"px":"",color:I.font&&I.font.color?I.font.color:"",backgroundColor:I.fill&&I.fill.color?I.fill.color:"",whiteSpace:I.wordWrap?"pre-wrap":"normal",format:A};if(I.borders){if(I.borders.left){this._parseBorderStyle(I.borders.left.style,"Left",n[W]);n[W].borderLeftColor=I.borders.left.color}if(I.borders.right){this._parseBorderStyle(I.borders.right.style,"Right",n[W]);n[W].borderRightColor=I.borders.right.color}if(I.borders.top){this._parseBorderStyle(I.borders.top.style,"Top",n[W]);n[W].borderTopColor=I.borders.top.color}if(I.borders.bottom){this._parseBorderStyle(I.borders.bottom.style,"Bottom",n[W]);n[W].borderBottomColor=I.borders.bottom.color}}if(I.fill&&I.fill.color){var B=n[W],D=I.borders,E=I.fill.color;if(D){D.left&&D.left.color||(B.borderLeftColor=E);D.right&&D.right.color||m===v-1||(B.borderRightColor=E);D.top&&D.top.color||(B.borderTopColor=E);D.bottom&&D.bottom.color||y===C-1||(B.borderBottomColor=E)}else{B.borderLeftColor=E;m!==v-1&&(B.borderRightColor=E);B.borderTopColor=E;y!==C-1&&(B.borderBottomColor=E)}}I.font&&-1===i.indexOf(I.font.family)&&i.push(I.font.family)}}r&&R&&isNumber(R.rowSpan)&&R.rowSpan>0&&isNumber(R.colSpan)&&R.colSpan>0&&(R.rowSpan>1||R.colSpan>1)&&s.push(new CellRange(y,m,y+R.rowSpan-1,m+R.colSpan-1))}if(T){this._checkParentCollapsed(a,T.groupLevel)||T.visible||null==T.visible||(e.rows[y-g].visible=T.visible);e.rows[y-g].wordWrap=!!T.style&&!!T.style.wordWrap||!!S}}p&&(p.isCollapsed=w);null!=v&&(e.frozenColumns=v);null!=C&&(e.frozenRows=x&&C>0?C-1:C);for(m=0;m<e.columnHeaders.columns.length;m++){var M=_[m],H=e.columns[m];H.isRequired=!1;if(M){M.dataType===DataType.Boolean&&(H.dataType=M.dataType);H.format=M.format;H.align=M.hAlign;H.wordWrap=H.wordWrap||!!M.wordWrap}}for(c=0;c<Math.max(g,1);c++)e.columnHeaders.rows.push(new Row);for(c=0;c<g;c++)for(var z=0;z<e.columnHeaders.columns.length;z++){var O=o.rows[c]?o.rows[c].cells[z]:null,j=O&&null!=O.value?O.value:"",L=e.columnHeaders.columns[z];if(j){var P=mXlsx.Workbook._parseExcelFormat(O);j=Globalize.format(j,P)}L.header=L.header||j;e.columnHeaders.setCellData(c,z,j)}if(r){var V=null==t.sheetVisible||t.sheetVisible;e.wj_sheetInfo.name=o.name;e.wj_sheetInfo.visible=!0===V||!1!==o.visible;e.wj_sheetInfo.styledCells=n;e.wj_sheetInfo.mergedRanges=s;e.wj_sheetInfo.fonts=i;e.wj_sheetInfo.tables=o.tables}}};FlexGridXlsxConverter._getColumnHeadersHeight=function(e){var l;if(!e||!(l=e.rows).length)return 0;if(!l[0])return 1;for(var t=0,o=1;t<l.length&&o>0;t++,o--){var r=l[t].cells.reduce((function(e,l){return Math.max(e,l.rowSpan||0)}),1);r>o&&(o=r)}return t};FlexGridXlsxConverter._escapePlainText=function(e){return null==e?"":""===e?"'":e&&("'"===e[0]||e.length>1&&"="===e[0]&&"="===e[1])?"'"+e:e};FlexGridXlsxConverter._parseFlexGridRowToSheetRow=function(e,l,t,o,r,n,s,i,a,u,c,d,f){var h,m,p,x,g,w,_,C,v,y,b,S,T,F,X,k,R,G,W,I,A,N,B,D,E,M,H,z,O,j=!1,L=!1;(W=(h=e.grid).wj_sheetInfo)&&(I=W.evaluateFormula);if(null==(m=e.rows[t]).recordIndex){D=0;e.cellType===CellType.ColumnHeader&&e.rows.length>1&&(D=t===r.length?t-1:t)}else D=m.recordIndex;l.cells||(l.cells=[]);l.visible=m.isVisible;l.height=m.renderHeight||e.rows.defaultSize;l.groupLevel=c;u&&(l.collapsed=m.isCollapsed);m.wordWrap&&(l.style={wordWrap:m.wordWrap});(m.constructor===Row||m.constructor===_NewRowTemplate||softTransposed()&&h instanceof softTransposed().TransposedGrid&&m instanceof Row||softDetail()&&m.constructor===softDetail().DetailRow||softMultiRow()&&m.constructor===softMultiRow()._MultiRow||softTransposedMultiRow()&&m instanceof softTransposedMultiRow()._MultiRow)&&(j=!0);softDetail()&&m.constructor===softDetail().DetailRow&&(L=!0);for(x=0;x<e.columns.length;x++){g=null;G=1;R=1;O=0;B=!1;X=null;null;M=null;C=null;N=h._getBindingColumn(e,t,e.columns[x]);k=null;if(W&&e===h.cells){F=t*e.columns.length+x;W.mergedRanges&&(k=this._getMergedRange(t,x,W.mergedRanges));W.styledCells&&(X=W.styledCells[F])}else if(n!==_IncludeCellStyles.None){M=this._getMeasureCell(e,x,s,i);X=(k=h.getMergedRange(e,t,x,!1))?this._getCellStyle(e,M,k.bottomRow,k.rightCol,a,!!f)||{}:this._getCellStyle(e,M,t,x,a,!!f)||{}}k||(k=h.getMergedRange(e,t,x,!1));if(k){if(t===k.topRow&&x===k.leftCol){R=k.bottomRow-k.topRow+1;G=this._getColSpan(e,k,d);B=!0}}else B=!0;if(!d||d(N)){p=r[D]?r[D][x+o]:null;if(j||u){_=B?e.getCellData(t,x,!0):null;v=B?e.getCellData(t,x,!1):null;b=this._isFormula(_);T=null;A=isDate(v);if(X&&X.format){g=X.format;/[hsmyt\:]/i.test(g)&&(A=!0);w=mXlsx.Workbook._parseCellFormat(X.format,A)}else if(p&&p.style&&p.style.format){g=N.format;w=p.style.format}else w=null;b&&null!=I&&isFunction(I)&&(T=I(_));if(!w)if(A)w="m/d/yyyy";else if(isNumber(v)&&!N.dataMap)w=isInt(v)?"#,##0":"#,##0.00";else if(b){if((S=_.toLowerCase()).indexOf("now()")>-1){w="m/d/yyyy h:mm";A=!0}else if(S.indexOf("today()")>-1||S.indexOf("date(")>-1){w="m/d/yyyy";A=!0}else if(S.indexOf("time(")>-1){w="h:mm AM/PM";A=!0}}else w="General"}else{_=B?h.columnHeaders.getCellData(0,x,!0):null;w="General"}if(isString(_)&&-1!==_.indexOf("<span")){C=this._parseToTextRuns(_);_=null}H=this._parseCellStyle(X)||{};if(e===h.cells&&u&&m.hasChildren&&x===h.columns.firstVisibleIndex){if(b&&null!=T)y=T;else{_?y=_:B&&(y=m.getGroupHeader());y&&(y=y.replace(/<\/?\w+>/g,"").replace(/&#39;/g,"'"))}if(null==y&&!X)continue;!(A=isDate(y))&&g&&"d"===g.toLowerCase()&&isInt(y)&&(w="0");y=isString(y)?mXlsx.Workbook._unescapeXML(y):y;x===h.columns.firstVisibleIndex&&h.treeIndent&&(O=c);E={value:y,isDate:A,formula:b?this._parseToExcelFormula(_,A):null,colSpan:G,rowSpan:R,style:this._extend(H,{format:w,font:{bold:!0},hAlign:mXlsx.HAlign.Left,indent:O}),textRuns:C}}else{_=isString(_)?mXlsx.Workbook._unescapeXML(_):_;v=isString(v)?mXlsx.Workbook._unescapeXML(v):v;!A&&g&&"d"===g.toLowerCase()&&isInt(v)&&(w="0");z=H&&H.hAlign?H.hAlign:p&&p.style&&null!=p.style.hAlign?asEnum(p.style.hAlign,mXlsx.HAlign,!0):isDate(v)?mXlsx.HAlign.Left:mXlsx.HAlign.General;x!==h.columns.firstVisibleIndex||!h.treeIndent||z!==mXlsx.HAlign.Left&&z!==mXlsx.HAlign.General||(O=c);E={value:b?T:"General"!==w||""===_&&null==v?this._escapePlainText(v):this._escapePlainText(_),isDate:A,formula:b?this._parseToExcelFormula(_,A):null,colSpan:x<h.columns.firstVisibleIndex?1:G,rowSpan:R,style:this._extend(H,{format:w,hAlign:z,vAlign:R>1?e===h.cells||!1===h.centerHeadersVertically?mXlsx.VAlign.Top:mXlsx.VAlign.Center:null,indent:O}),textRuns:C}}f&&f(new XlsxFormatItemEventArgs(e,new CellRange(t,x),M,s,i,a,E));if(L){var P=e.getCellElement(t,x);if(P){var V=m.detail;P.appendChild(V);Control.refreshAll(V)}}l.cells.push(E)}}return o+x};FlexGridXlsxConverter._parseCellStyle=function(e,l){void 0===l&&(l=!1);if(null==e)return null;var t=e.fontSize;t=t?+t.substring(0,t.indexOf("px")):null;isNaN(t)&&(t=null);var o=e.whiteSpace;o=!!o&&o.indexOf("pre")>-1;var r=e.textAlign;"start"===r&&(r="rtl"===e.direction?"right":"left");"end"===r&&(r="rtl"===e.direction?"left":"right");return{font:{bold:"bold"===e.fontWeight||+e.fontWeight>=700,italic:"italic"===e.fontStyle,underline:"underline"===(e.textDecorationStyle||e.textDecoration),family:this._parseToExcelFontFamily(e.fontFamily),size:t,color:e.color},fill:{color:e.backgroundColor},borders:this._parseBorder(e,l),hAlign:mXlsx.Workbook._parseStringToHAlign(r),wordWrap:o}};FlexGridXlsxConverter._parseBorder=function(e,l){var t={};t.left=this._parseEgdeBorder(e,"Left");t.right=this._parseEgdeBorder(e,"Right");t.top=this._parseEgdeBorder(e,"Top");t.bottom=this._parseEgdeBorder(e,"Bottom");if(l){t.vertical=this._parseEgdeBorder(e,"Vertical");t.horizontal=this._parseEgdeBorder(e,"Horizontal")}return t};FlexGridXlsxConverter._parseEgdeBorder=function(e,l){var t,o=e["border"+l+"Style"],r=e["border"+l+"Width"];r&&(r=parseFloat(r));if(o&&"none"!==o&&"hidden"!==o&&0!==r){t={};switch(o=o.toLowerCase()){case"dotted":t.style=r>1?mXlsx.BorderStyle.MediumDashDotted:mXlsx.BorderStyle.Dotted;break;case"dashed":t.style=r>1?mXlsx.BorderStyle.MediumDashed:mXlsx.BorderStyle.Dashed;break;case"double":t.style=mXlsx.BorderStyle.Double;break;default:t.style=r>2?mXlsx.BorderStyle.Thick:r>1?mXlsx.BorderStyle.Medium:mXlsx.BorderStyle.Thin}t.color=e["border"+l+"Color"]}return t};FlexGridXlsxConverter._parseBorderStyle=function(e,l,t){var o="border"+l+"Style",r="border"+l+"Width";switch(e){case mXlsx.BorderStyle.Dotted:case mXlsx.BorderStyle.Hair:t[o]="dotted";t[r]="1px";break;case mXlsx.BorderStyle.Dashed:case mXlsx.BorderStyle.ThinDashDotDotted:case mXlsx.BorderStyle.ThinDashDotted:t[o]="dashed";t[r]="1px";break;case mXlsx.BorderStyle.MediumDashed:case mXlsx.BorderStyle.MediumDashDotDotted:case mXlsx.BorderStyle.MediumDashDotted:case mXlsx.BorderStyle.SlantedMediumDashDotted:t[o]="dashed";t[r]="2px";break;case mXlsx.BorderStyle.Double:t[o]="double";t[r]="3px";break;case mXlsx.BorderStyle.Medium:t[o]="solid";t[r]="2px";break;case mXlsx.BorderStyle.Thick:t[o]="solid";t[r]="3px";break;default:t[o]="solid";t[r]="1px"}};FlexGridXlsxConverter._parseToExcelFontFamily=function(e){var l;e&&(l=e.split(","))&&l.length>0&&(e=l[0].replace(/\"|\'/g,""));return e};FlexGridXlsxConverter._parseToExcelFormula=function(e,l){var t,o,r,n,s,i,a,u=/\"?\w+\"?\s*\,\s*\"(\w+)\"/i;if(t=e.match(/(floor|ceiling)\([+-]?\d+\.?\d*\)/gi))for(s=0;s<t.length;s++){a=(i=t[s]).substring(0,i.lastIndexOf(")"))+", 1)";e=e.replace(i,a)}t=null;if(t=e.match(/text\(\"?\w+\"?\s*\,\s*\"\w+\"\)/gi))for(s=0;s<t.length;s++)if((o=(i=t[s]).match(u))&&2===o.length){r=o[1];if(!/^d{1,4}?$/.test(r)){n=mXlsx.Workbook._parseCellFormat(r,l);a=i.replace(r,n);e=e.replace(i,a)}}return e};FlexGridXlsxConverter._parseToTextRuns=function(e){var l,t,o,r=e.split("<span "),n=[];for(l=0;l<r.length;l++){o=-1!==(t=r[l]).indexOf("</span>")?{text:t.substring(t.indexOf(">")+1,t.indexOf("</span>")),font:this._parseToTextRunFont(t.substring(t.indexOf('style="')+7,t.indexOf(';"')))}:{text:t};n.push(o)}return n};FlexGridXlsxConverter._parseToTextRunFont=function(e){var l,t,o,r,n,s,i,a,u,c=e.split(";");if(c.length>0){for(l=0;l<c.length;l++)if(2===(t=c[l].split(":")).length){t[1]=t[1].trim();switch(t[0]){case"font-size":s=+t[1].substring(0,t[1].indexOf("px"));isNaN(s)&&(s=null);break;case"font-weight":o="bold"===t[1]||+t[1]>=700;break;case"font-style":r="italic"===t[1];break;case"text-decoration-style":case"text-decoration":n="underline"===t[1];break;case"font-family":i=this._parseToExcelFontFamily(t[1]);break;case"color":a=t[1]}}u={bold:o,italic:r,underline:n,family:i,size:s,color:a}}return u};FlexGridXlsxConverter._getMeasureCell=function(e,l,t,o){var r=o[e.cellType],n=r&&r[l],s=null==n;if(n){if(this.hasCssText){n.style;n.style.cssText="";n.style.visibility="hidden"}}else{r||(o[e.cellType]=r=[]);r[l]=n=t.cloneNode()}!s&&n.parentElement||(e.hostElement.children.length>0?e.hostElement.children[0].appendChild(n):e.hostElement.appendChild(n));return n};FlexGridXlsxConverter._getColumnSetting=function(e,l,t){var o=e;null!=e.colspan&&(o=this._getRenderColumn(l,t));return o?{autoWidth:!0,width:o.renderWidth||t.defaultSize,visible:o.visible&&0!==o.width,style:{format:e.format?mXlsx.Workbook._parseCellFormat(e.format,e.dataType===DataType.Date):"",hAlign:mXlsx.Workbook._parseStringToHAlign(this._toExcelHAlign(o.getAlignment())),wordWrap:o.wordWrap}}:null};FlexGridXlsxConverter._getPerRowColumnsSettings=function(e,l,t){var o=this,r=[],n=[];l.forEach((function(s,i){for(var a=0,u=i>0?l[0].columns.length:0,c=0;c<s.rows.length&&!(null!=t&&c>=t);c++)if(!(s.rows[c].renderSize<=0)){r[a]=r[a]||[];n[a]=n[a]||[];s.columns.forEach((function(l,t){var i=e._getBindingColumn(s,c,l),d=o._getColumnSetting(i,t,s.columns);if(d){r[a][u+t]=d;n[a][u+t]=i}}));a++}}));return{cols:r,bndCols:n}};FlexGridXlsxConverter._toExcelHAlign=function(e){return(e=e?e.trim().toLowerCase():e)?e.indexOf("center")>-1?"center":e.indexOf("right")>-1||e.indexOf("end")>-1?"right":e.indexOf("justify")>-1?"justify":"left":e};FlexGridXlsxConverter._getColumnCount=function(e){for(var l,t=0,o=0,r=0;r<e.length;r++)if((l=e[r]&&e[r].cells?e[r].cells:[])&&l.length>0){o=l.length;isInt(l[o-1].colSpan)&&l[o-1].colSpan>1&&(o=o+l[o-1].colSpan-1);o>t&&(t=o)}return t};FlexGridXlsxConverter._getRowCount=function(e,l){for(var t,o,r=e.length,n=r-1,s=0;s<l;s++)e:for(;n>=0;n--)if((o=((t=e[n])&&t.cells?t.cells:[])[s])&&(null!=o.value&&""!==o.value||isInt(o.rowSpan)&&o.rowSpan>1)){isInt(o.rowSpan)&&o.rowSpan>1&&n+o.rowSpan>r&&(r=n+o.rowSpan);break e}return r};FlexGridXlsxConverter._numAlpha=function(e){var l=Math.floor(e/26)-1;return(l>-1?this._numAlpha(l):"")+String.fromCharCode(65+e%26)};FlexGridXlsxConverter._getItemType=function(e){return null==e||null==e.value||isNaN(e.value)?null:getType(e.value)};FlexGridXlsxConverter._setColumn=function(e,l,t){var o,r,n,s=e[l];if(s){o=this._getItemType(t);s.dataType!==o&&s.dataType===DataType.Boolean&&o!==DataType.Boolean&&(s.dataType=o);!t||null==t.value||isString(t.value)&&isNullOrWhiteSpace(t.value)||(r=mXlsx.Workbook._parseExcelFormat(t))&&s.format!==r&&"General"!==r&&(s.format=r);if(t&&t.style){t.style.hAlign&&(n=mXlsx.Workbook._parseHAlignToString(asEnum(t.style.hAlign,mXlsx.HAlign)));null==s.wordWrap?s.wordWrap=!!t.style.wordWrap:s.wordWrap=s.wordWrap&&!!t.style.wordWrap}n||o!==DataType.Number||(n="right");s.hAlign=n}else e[l]={dataType:this._getItemType(t),format:mXlsx.Workbook._parseExcelFormat(t),hAlign:"",wordWrap:null}};FlexGridXlsxConverter._getItemValue=function(e){if(null==e||null==e.value)return null;var l=e.value;isString(l)&&"'"===l[0]&&(l=l.substr(1));return isNumber(l)&&isNaN(l)?"":l instanceof Date&&isNaN(l.getTime())?"":l};FlexGridXlsxConverter._getCellStyle=function(e,l,t,o,r,n){var s,i=e.grid;try{var a=!(r&&!i.formatItem.hasHandlers&&!i.itemFormatter&&!n);i.cellFactory.updateCell(e,t,o,l,null,a);l.className=l.className.replace("wj-state-selected","");l.className=l.className.replace("wj-state-multi-selected","")}catch(e){return null}if(r){var u,c=e.hostElement,d=l;u=d.style.cssText.split(/;\s+/).filter((function(e){var l=e.substring(0,e.indexOf(":"));return/^(color|background|border|font|text|whitespace)/i.test(l)})).join(";");do{u=d.className+u}while(d!==c&&(d=d.parentElement));if(!(s=r.getValue(u))){s=window.getComputedStyle(l);r.add(u,s)}}else s=window.getComputedStyle(l);return s};FlexGridXlsxConverter._parseTextRunsToHTML=function(e){var l,t,o,r;o="";for(r=0;r<e.length;r++)o+=(t=(l=e[r]).font)?'<span style="'+(t.bold?"font-weight: bold;":"")+(t.italic?"font-style: italic;":"")+(t.underline?"text-decoration: underline;":"")+(t.family?"font-family: "+t.family+";":"")+(null!=t.size?"font-size: "+t.size+"px;":"")+(t.color?"color: "+t.color+";":"")+'">'+l.text+"</span>":l.text;return o};FlexGridXlsxConverter._extend=function(e,l){for(var t in l){var o=l[t];isObject(o)&&e[t]?copy(e[t],o):e[t]=o}return e};FlexGridXlsxConverter._checkParentCollapsed=function(e,l){var t=!1;Object.keys(e).forEach((function(o){!0===e[o]&&!1===t&&!isNaN(l)&&+o<l&&(t=!0)}));return t};FlexGridXlsxConverter._getColSpan=function(e,l,t){for(var o=0,r=l.leftCol;r<=l.rightCol;r++)t&&!t(e.columns[r])||o++;return o};FlexGridXlsxConverter._getRenderColumn=function(e,l){return e>=l.length?null:l[e]};FlexGridXlsxConverter._getMergedRange=function(e,l,t){var o,r;for(o=0;o<t.length;o++)if(e>=(r=t[o]).topRow&&e<=r.bottomRow&&l>=r.leftCol&&l<=r.rightCol)return r;return null};FlexGridXlsxConverter._isFormula=function(e){return e&&"string"==typeof e&&e.length>1&&"="===e[0]&&"="!==e[1]};return FlexGridXlsxConverter}();export{FlexGridXlsxConverter};var _IncludeCellStyles,XlsxFormatItemEventArgs=function(e){__extends(XlsxFormatItemEventArgs,e);function XlsxFormatItemEventArgs(l,t,o,r,n,s,i){var a=e.call(this,l,t)||this;a._cell=o;a._patternCell=r;a._xlsxCell=i;a._cellsCache=n;a._styleCache=s;return a}Object.defineProperty(XlsxFormatItemEventArgs.prototype,"cell",{get:function(){return this._cell},enumerable:!0,configurable:!0});Object.defineProperty(XlsxFormatItemEventArgs.prototype,"xlsxCell",{get:function(){return this._xlsxCell},set:function(e){this._xlsxCell=e},enumerable:!0,configurable:!0});XlsxFormatItemEventArgs.prototype.getFormattedCell=function(){if(!this._cell){this._cell=FlexGridXlsxConverter._getMeasureCell(this.panel,this.col,this._patternCell,this._cellsCache);FlexGridXlsxConverter._getCellStyle(this.panel,this._cell,this.row,this.col,this._styleCache,!0)}return this._cell};return XlsxFormatItemEventArgs}(CellRangeEventArgs);export{XlsxFormatItemEventArgs};!function(e){e[e.None=0]="None";e[e.Regular=1]="Regular";e[e.Cache=2]="Cache"}(_IncludeCellStyles||(_IncludeCellStyles={}));var _StyleCache=function(){function _StyleCache(e){this._cache={};this._size=0;this._max=e}_StyleCache.prototype.add=function(e,l){this._size>=this._max&&this.clear();this._cache[e]=this._cloneStyle(l);this._size++};_StyleCache.prototype.clear=function(){this._cache={};this._size=0};_StyleCache.prototype.getValue=function(e){return this._cache[e]||null};_StyleCache.prototype.hasKey=function(e){return!!this._cache[e]};_StyleCache.prototype._cloneStyle=function(e){if(!e)return null;for(var l={},toCamel=function(e){return e.replace(/\-([a-z])/g,(function(e,l,t){return t>0?l.toUpperCase():l}))},t=0,o=e.length;t<o;t++){var r=e[t];l[toCamel(r)]=e.getPropertyValue(r)}return l};return _StyleCache}();export{_StyleCache};export function _blobToBuffer(e,l){if(e&&l)if(e.arrayBuffer)e.arrayBuffer().then((function(e){return l(e)}));else{var t=new FileReader;t.onload=function(){l(t.result);t=null};t.readAsArrayBuffer(e)}}_registerModule("wijmo.grid.xlsx",selfModule);